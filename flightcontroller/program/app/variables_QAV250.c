#include "variables.h"
#if THIS_PLANE == QAV250
int t = 0, tTrans = 0;
int temp_111;

//AHRS_TypeDef AHRS, AHRS0;
float dis_set_hight;
float ControlOutput_ZChannel;
void PID_Controller::reset()
{
  this->I = 0;
}

PID_Controller 
gyroX = 
{
  .Kp0  = 30, 
  .Ki0  = 7,
  .Kd0  = 280, 
  .fuzzy = 0,
  .D_smoother = 0.2,
  .smoother = 0,
  .integralLimit = 200000,
  .outputLimit  = 500,
  .OffsetBound  = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .OffsetDBound = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .KpStrategy   = {  
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KiStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KdStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  }
}, 


gyroY = 
{
  .Kp0  = 35,
  .Ki0  = 7,
  .Kd0  = 400,
  .fuzzy = 0,
  .D_smoother = 0.2,
  .smoother = 0,
  .integralLimit = 200000,
  .outputLimit  = 500,
  .OffsetBound  = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .OffsetDBound = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .KpStrategy   = {  
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KiStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KdStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  }
},


gyroZ = 
{
  .Kp0  = 1000, 
  .Ki0  = 0,
  .Kd0  = 200, 
  .fuzzy = 0,
  .D_smoother = 0.2,
  .smoother = 0,
  .integralLimit = 200000,
  .outputLimit  = 200,
  .OffsetBound  = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .OffsetDBound = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .KpStrategy   = {  
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KiStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KdStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  }
},

/*****************************************************************************/
/*****************************************************************************/

angleX = 
{
  .Kp0  = 9000,
  .Ki0  = 500,
  .Kd0  = 1200,
  .fuzzy = 0,
  .smoother = 0,
  .integralLimit = 4000,
  .outputLimit  = 1500,
  .OffsetBound  = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .OffsetDBound = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .KpStrategy   = {  
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KiStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KdStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  }
},



angleY = 
{
  .Kp0  = 12000,
  .Ki0  = 500,
  .Kd0  = 1200,
  .fuzzy = 0,
  .smoother = 0,
  .integralLimit = 4000,
  .outputLimit  = 1500,
  .OffsetBound  = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .OffsetDBound = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .KpStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KiStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KdStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  }
},

angleZ = 
{
  .Kp0  = 1800,
  .Ki0  = 0,
  .Kd0  = 200,
  .fuzzy = 0,
  .smoother = 0,
  .integralLimit = 4000,
  .outputLimit  = 150,
  .OffsetBound  = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .OffsetDBound = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .KpStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KiStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KdStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  }
},

/*****************************************************************************/
/*****************************************************************************/

positionZ = 
{
  .Kp0  = 150000,
  .Ki0  = 200,
  .Kd0  = 500000,
  .fuzzy = 0,
  .D_smoother = 0.99,
  .smoother = 0,
  .integralLimit = 400000,
  .outputLimit  = 500,
  .OffsetBound  = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .OffsetDBound = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .KpStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KiStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KdStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  }
},
positionX = 
{
  .Kp0  = 150000,
  .Ki0  = 200,
  .Kd0  = 500000,
  .fuzzy = 0,
  .D_smoother = 0.99,
  .smoother = 0,
  .integralLimit = 400000,
  .outputLimit  = 500,
  .OffsetBound  = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .OffsetDBound = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .KpStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KiStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KdStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  }
},
positionY = 
{
  .Kp0  = 150000,
  .Ki0  = 200,
  .Kd0  = 500000,
  .fuzzy = 0,
  .D_smoother = 0.99,
  .smoother = 0,
  .integralLimit = 400000,
  .outputLimit  = 500,
  .OffsetBound  = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .OffsetDBound = {-420 , -300 , -180 , 0 , 180 , 300 , 420},
  .KpStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KiStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  },

  .KdStrategy   = {
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  },
                    {  90,   90,  90,  90,  99,  90,  90  },
                    {  90,   90,  90,  90,  90,  90,  90  }
                  }
}
;
/*****************************************************************************/
/*****************************************************************************/


Rotor controlOutput;

void findDifference::getresult(float data, float min, float max, int num)
{
  this->min = max;
  this->max = min;
  
  for(int i=0; i<num; i++)
  {
    this->H[i] = this->H[i+1];
    
    if(this->H[i] < this->min) this->min = this->H[i];
    if(this->H[i] > this->max) this->max = this->H[i];
  }
  this->diff = this->max - this->min;
  this->H[num] = data;
}

findDifference Diffa;


float roll, pitch, yaw;
float roll1, pitch1, yaw1, yaw2;


int powerVoltage_12;
int updateErrorCnt = 0;

int OffsetMembership_X[NUM]={0};
int OffsetDMembership_X[NUM]={0};

int OffsetMembership_Y[NUM]={0};
int OffsetDMembership_Y[NUM]={0};


int   rowTX_X = 0;
int   columnTX_X = 0;
int   Kp_X = 80,  Ki_X = 80,  Kd_X = 80;
int   Kp_X0 = 20, Ki_X0 = 50, Kd_X0 = 5;


int   rowTX_Y = 0;
int   columnTX_Y = 0;
int   Kp_Y = 80,  Ki_Y = 80,  Kd_Y = 80;
int   Kp_Y0 = 20, Ki_Y0 = 50, Kd_Y0 = 5;


int fanIniSpd = 4250;

int rotor1, rotor2, rotor3, rotor4;
#endif